
# Story 1.10: Feed Notifications & Share Hooks

## Status
Ready

## Story
**As a** creator or engaged user of Pod.Style,
**I want** feed interactions (likes, comments, shares, remixes) to trigger timely notifications and shareable links,
**so that** I stay informed about engagement and can amplify creations beyond the platform.

## Acceptance Criteria
1. Interactions on feed entries (like/favorite/comment/share/remake) invoke server actions that log events via `social-service`, update counters (`creations`, `personalized_feed_cache`), and enqueue notifications without regressing existing functionality.  
2. Notification pipeline (Cloud Function or service) writes to `notifications` collection and supports push/email triggers following the moderation-safe workflow.  
3. Each feed entry exposes a shareable link/metadata (OG tags, tracking params) ensuring links respect feature flags and legacy routes.  
4. Observability captures interaction events (counts, latency), notification success/failure, and ensures dashboards track engagement metrics segmented by feed variant.  
5. Tests cover interaction logging, notification enqueueing, share link generation, and regression against legacy `/` path when feature flag disabled.

## Tasks / Subtasks
- [ ] Interaction logging (AC: 1)  
  - [ ] Extend server actions to call `social-service.logInteraction`, updating counters + ranking signals.  
  - [ ] Ensure AC compatibility with existing creation interaction flows.  
- [ ] Notification pipeline (AC: 2)  
  - [ ] Cloud Function or queue consumer writes notification entries, respecting moderation states.  
  - [ ] Support push/email triggers via existing notification framework.  
- [ ] Share link support (AC: 3)  
  - [ ] Provide shareable URLs with OG metadata; handle `/beta` vs legacy path.  
  - [ ] Document share tracking parameters for analytics.  
- [ ] Observability (AC: 4)  
  - [ ] Emit metrics (`feed.interaction.count`, `feed.notification.success`) and log failures.  
  - [ ] Update dashboards/alerts for interaction spikes or failures.  
- [ ] Testing (AC: 5)  
  - [ ] Jest tests for interaction logging + notification queue.  
  - [ ] Playwright tests verifying share links and notifications triggered.  
  - [ ] Manual regression ensuring legacy interactions unaffected.

## Dev Notes
### Previous Story Insights
- Stories 1.1–1.9 established feed, ranking, ingestion, search, moderation. Interaction/notification layer ties engagement back to feed quality.

### Data Models
- `social_edges`, `engagement_events`, `notifications` track interactions; ensure consistency with existing schema.  
  `[Source: architecture-brownfield.md#53-data-model]`

### API & Service Specifications
- Interaction logging route uses `logInteraction` and updates `personalized_feed_cache` ranking signals.  
  `[Source: architecture.md#4-application-architecture]`
- Notification service orchestrates push/email; align with moderation to avoid notifying about removed content.  
  `[Source: architecture-brownfield.md#52-backend-services]`

### Component Specifications
- Feed UI surfaces share buttons; ensure user experience consistent across variants.  
  `[Source: architecture.md#3-business-user-experience-architecture]`

### File Locations & Project Structure
- Interaction logic resides `src/features/social/server/`; feed actions call into it.  
  `[Source: architecture.md#41-components--responsibilities]`
- Notifications pipeline in `functions/` or server services per architecture guidance.  
  `[Source: architecture-brownfield.md#6-workflows]`

### Testing Requirements
- Unit tests for interaction logging, notification writer, share link builder.  
  `[Source: architecture.md#8-testing-strategy]`
- Integration tests verifying notifications appear and share links resolve.  
  `[Source: architecture.md#8-testing-strategy]`

### Technical Constraints
- Feature flags must control new UI so legacy flow unaffected.  
  `[Source: architecture.md#11-next-steps]`
- Observability metrics integrate with existing dashboards.  
  `[Source: architecture.md#74-observability]`
- Share links must respect moderation (no exposing removed content).  
  `[Source: architecture-brownfield.md#55-moderation--safety]`

## Testing
- Jest unit tests for interactions and notifications. `[Source: architecture.md#8-testing-strategy]`
- Playwright tests for share links and UI actions. `[Source: architecture.md#8-testing-strategy]`

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-01-12 | v0.1 | Draft covering feed interactions & notifications | Bob (scrum-master) |

## QA Results

### Review Date: 2025-09-28
### Reviewed By: Quinn (Test Architect)

#### Code Quality Assessment
- 锚点 slug 与状态问题尚未解决。

#### Test Strategy & Coverage
- 未审代码，测试未评估。

#### NFR Assessment
- Not assessed。

#### Issues
1. 修复以下锚点：
   - `architecture-brownfield.md#53-data-model` → `architecture-brownfield.md#53-data-model`
   - `architecture.md#4-application-architecture` → `architecture.md#4-application-architecture`
   - `architecture-brownfield.md#52-backend-services` → `architecture-brownfield.md#52-backend-services`
   - `architecture.md#3-business-user-experience-architecture` → `architecture.md#3-business-user-experience-architecture`
   - `architecture.md#41-components--responsibilities` → `architecture.md#41-components--responsibilities`
   - `architecture-brownfield.md#6-workflows` → `architecture-brownfield.md#6-workflows`
   - `architecture.md#8-testing-strategy` (无需变)
   - `architecture.md#11-next-steps` → `architecture.md#11-next-steps`
   - `architecture.md#74-observability` → `architecture.md#74-observability`
   - `architecture-brownfield.md#55-moderation--safety` → `architecture-brownfield.md#55-moderation--safety`
2. `Status` 应更新为 `Ready`。`docs/stories/1.10.feed-notifications-and-sharing.md:4`

#### Recommendations
- 统一锚点及状态，再提交复检。

#### Suggested Status
- Changes Required

### Review Date: 2025-09-28 (二次复核)
### Reviewed By: Quinn (Test Architect)

#### Code Quality Assessment
- 相关引用 slug 已统一，故事状态更新为 `Ready`；互动与通知流程描述完整。

#### Test Strategy & Coverage
- 尚未进入实现阶段，暂不评估测试。

#### NFR Assessment
- Not assessed。

#### Issues
- None.

#### Recommendations
- 实现分享链接时需再次验证 moderation 过滤以及 OG 元信息的一致性，确保 metrics 能按 variant 分段。

#### Suggested Status
- Pass
