
# Story 4.4: Notification Inbox & Preferences

## Status
Draft

## Story
**As a** Pod.Style user,
**I want** a unified notification inbox and preference controls,
**so that** I can manage social activity, follows, comments, and purchases effectively.

## Acceptance Criteria
1. Build a notification inbox UI (in profile area) listing notifications from `notifications` collection, grouped by type (follow, comment, remix, order, moderation) with read/unread states.  
2. Provide notification preference controls (email, push, in-app) allowing users to enable/disable categories; store preferences in user profile.  
3. Server-side notification pipeline respects preferences before sending alerts and records read/unread state changes.  
4. Observability tracks notification delivery success/failure per channel and logs preference changes.  
5. Tests cover inbox display, preference toggles, notification send pipelines, and regression when social features disabled.

## Tasks / Subtasks
- [ ] Inbox UI (AC: 1)  
  - [ ] Create notification inbox page/component; support pagination and mark-read actions.  
  - [ ] Display grouped notifications with timestamps.  
- [ ] Preferences (AC: 2)  
  - [ ] Add settings page for notification categories; persist in user profile.  
  - [ ] Reflect preferences across channels.  
- [ ] Pipeline updates (AC: 3)  
  - [ ] Modify notification service to check preferences before sending.  
  - [ ] Update read/unread state in `notifications`.  
- [ ] Observability (AC: 4)  
  - [ ] Emit metrics (`notification.channel.success/failure`).  
  - [ ] Log preference changes for audit.  
- [ ] Testing (AC: 5)  
  - [ ] Jest tests for preferences + pipeline checks.  
  - [ ] Playwright tests for inbox UI and preference toggles.  
  - [ ] Manual regression ensuring feature flag fallback.

## Dev Notes
### Data Models
- `notifications` stores inbox items; ensure structure aligns with design.  
  `[Source: architecture-brownfield.md#5.3-Data-Model]`

### Services
- Notification service described in architecture; integrate preference checks.  
  `[Source: architecture.md#4-Application-Architecture]`

### UI
- Inbox obeys design tokens; preference toggles accessible.  
  `[Source: architecture.md#3-Business-User-Experience-Architecture]`

### File Structure
- Components under `src/components/screens/notification-inbox.tsx`; server logic in `src/features/notifications`.  
  `[Source: architecture.md#4.1-Components-&-Responsibilities]`

### Testing Requirements
- Unit/integration tests per testing strategy.  
  `[Source: architecture.md#8-Testing-Strategy]`

### Constraints
- Feature flag to enable inbox; ensure privacy (no sensitive info in notifications).  
  `[Source: architecture.md#Next-Steps]`

## Testing
- Jest tests for notification preferences/pipeline. `[Source: architecture.md#8-Testing-Strategy]`
- Playwright tests for inbox UI. `[Source: architecture.md#8-Testing-Strategy]`

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-01-12 | v0.1 | Draft for notification inbox & preferences | Bob (scrum-master) |
