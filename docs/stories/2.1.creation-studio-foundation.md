
# Story 2.1: Creation Studio Foundation

## Status
Draft

## Story
**As a** creator launching Pod.Style,
**I want** a dedicated creation studio route where I can compose prompts, see generated patterns, and configure product options,
**so that** I can produce shareable creations without dealing with raw backend flows.

## Acceptance Criteria
1. Add a new Next.js route group `(studio)` with an entry page that renders the creation workflow, wrapped with `AuthProvider` to ensure only authenticated users access generation features.  
2. UI presents prompt input, optional inspiration image upload, style selection, and displays generation results returned from server actions powering AI pipelines (initial stubs accepted).  
3. Integrate existing Genkit flows (`generateTShirtPatternWithStyle`, `generateModelMockup`) via server actions, respecting feature flags/local dev configuration, and deliver results to the UI seamlessly.  
4. Provide product configuration form (size, color, quantity) and prepare payload structures to persist creations; actual persistence can be stubbed but must be structured to integrate with future stories.  
5. Observability and testing: log generation requests/results, provide quick fallback messages on failure, and add unit/integration tests covering core workflow and feature flag behavior.

## Tasks / Subtasks
- [ ] Studio route scaffolding (AC: 1)  
  - [ ] Create `(studio)/layout.tsx` & `(studio)/page.tsx` using existing providers.  
  - [ ] Redirect unauthenticated users to login or prompt to sign in.  
- [ ] UI workflow (AC: 2,4)  
  - [ ] Build `CreationStudioScreen` with sections for prompt input, inspiration upload, style selector, generation preview, product config.  
  - [ ] Handle loading/error states; display placeholder when no generation yet.  
- [ ] Server actions integration (AC: 3)  
  - [ ] Create `src/features/creations/server/studio-actions.ts` calling Genkit flows with proper validation (Zod).  
  - [ ] Ensure feature flag allows toggling AI generation (use env/Remote Config).  
- [ ] Observability & stubs (AC: 3,5)  
  - [ ] Log generation requests/results (`studio.generate.*`) using logger utilities.  
  - [ ] Provide stubbed persistence function (to be implemented later) returning structured payload.  
- [ ] Testing (AC: 5)  
  - [ ] Jest tests for server actions (happy path + error).  
  - [ ] Playwright test covering basic studio flow under feature flag; ensure fallback message when disabled.  

## Dev Notes
### Data Models & Context
- Creations schema includes prompt, style, patternUri, models, etc.; ensure result structure aligns with `Creation` interface.  
  `[Source: architecture.md#5-Data-Architecture]`
- Personalization requires hooking into user models (future stories); this story sets groundwork.  
  `[Source: architecture.md#3-Business-User-Experience-Architecture]`

### API & Service Specs
- Use existing Genkit flows (`generateTShirtPatternWithStyle`, `generateModelMockup`) for generation pipeline.  
  `[Source: architecture.md#4-Application-Architecture]`
- Server actions must validate input and handle feature flags / env keys.  
  `[Source: architecture.md#6-Integration-Architecture]`

### Component Specs
- UI should follow design tokens (Tailwind + Radix).  
  `[Source: architecture.md#3-Business-User-Experience-Architecture]`

### File Locations & Project Structure
- Place components under `src/components/screens/creation-studio.tsx` or similar.  
  `[Source: architecture.md#4.1-Components-&-Responsibilities]`
- Server actions under `src/features/creations/server/`.  
  `[Source: architecture.md#4-Application-Architecture]`

### Testing Requirements
- Unit + integration tests as detailed.  
  `[Source: architecture.md#8-Testing-Strategy]`

### Technical Constraints
- Feature flags required; ensure genkit keys loaded via env.  
  `[Source: architecture-brownfield.md#10-Migration-&-Rollout-Strategy]`
- Ensure App Check/Auth gating ensures only authenticated users run generation.  
  `[Source: architecture.md#9-Security-Integration]`

## Testing
- Jest unit tests for server actions. `[Source: architecture.md#8-Testing-Strategy]`
- Playwright test for UI flow. `[Source: architecture.md#8-Testing-Strategy]`

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-01-12 | v0.1 | Initial creation studio foundation story | Bob (scrum-master) |
